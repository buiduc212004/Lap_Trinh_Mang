<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WebTransport Chat & File Transfer</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="main-container">
      <!-- WebTransport Header -->
      <div class="webtransport-header">
        <div class="webtransport-logo">
          <div class="icon">
            <i class="fas fa-comments"></i>
          </div>
          <h1 class="title">WebTransport Chat & Files</h1>
        </div>
        <div id="connection-status" class="connection-status status-disconnected">
          <div class="status-dot"></div>
          <span id="status-text">Disconnected</span>
        </div>
      </div>

      <!-- Connection Panel -->
      <div class="connection-panel">
        <div class="field">
          <label class="label">Your Name</label>
          <input 
            class="input" 
            type="text" 
            id="name" 
            placeholder="Enter your name"
            maxlength="20"
          />
        </div>
        <button type="button" class="button is-success" id="join-button">
          <i class="fas fa-sign-in-alt"></i>
          Join Chat
        </button>
        <button type="button" class="button is-danger" id="disconnect-button" disabled>
          <i class="fas fa-sign-out-alt"></i>
          Disconnect
        </button>
      </div>

      <!-- Chat Container -->
      <div class="chat-container">
        <!-- Main Chat Area -->
        <div class="chat-main">
          <div class="chat-header">
            <div class="chat-title">
              <i class="fas fa-comments"></i>
              <span>Chat Room</span>
            </div>
          </div>
          
          <div id="messages" class="chat-messages"></div>
          
          <!-- File Upload Section -->
          <div class="file-upload-section">
            <div class="file-upload-controls">
              <input type="file" id="file-input" style="display: none;" onchange="handleFileSelect()">
              <button type="button" class="button file-select-btn" onclick="document.getElementById('file-input').click()">
                <i class="fas fa-paperclip"></i>
                Attach File
              </button>
              <button type="button" class="button drawing-btn" onclick="openDrawingModal()">
                <i class="fas fa-paint-brush"></i>
                Draw
              </button>
              <button type="button" class="button is-primary" id="file-upload-btn" onclick="handleFileUpload(event)" style="display: none;">
                <i class="fas fa-upload"></i>
                Upload
              </button>
            </div>
            <div id="selected-file-info" class="selected-file-info"></div>
            <div id="upload-progress" class="upload-progress" style="display: none;">
              <div class="progress-bar-container">
                <div id="upload-progress-bar" class="progress-bar"></div>
              </div>
              <div id="upload-progress-text" class="progress-text">Uploading...</div>
            </div>
          </div>

          <!-- Message Input -->
          <div class="chat-input-container">
            <div class="input-group">
              <input
                class="input"
                type="text"
                id="message"
                placeholder="Type your message here..."
                disabled
                maxlength="500"
              />
              <button class="button" id="send-button" disabled>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="sidebar-container">
          <!-- Online Users -->
          <div class="sidebar">
            <div class="sidebar-header">
              <div class="sidebar-title">
                <i class="fas fa-users"></i>
                <span>Online Users</span>
              </div>
              <span class="user-count" id="user-count">0</span>
            </div>
            <div id="online-list" class="online-list">
              <div class="has-text-centered has-text-grey">
                <i class="fas fa-user-friends fa-2x" style="opacity: 0.3;"></i>
                <p style="margin-top: 10px;">No users online</p>
              </div>
            </div>
          </div>

          <!-- Available Files -->
          <div class="sidebar files-sidebar">
            <div class="sidebar-header">
              <div class="sidebar-title">
                <i class="fas fa-folder"></i>
                <span>Shared Files</span>
              </div>
            </div>
            <div id="available-files-list" class="files-list">
              <div class="has-text-centered has-text-grey" style="padding: 2rem;">
                <i class="fas fa-folder-open fa-2x" style="opacity: 0.3;"></i>
                <p style="margin-top: 10px;">No files available</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Drawing Modal -->
      <div id="drawing-modal" class="modal">
        <div class="modal-background" onclick="closeDrawingModal()"></div>
        <div class="modal-content drawing-modal-content">
          <div class="drawing-header">
            <h3 class="drawing-title">
              <i class="fas fa-paint-brush"></i>
              Draw & Share
            </h3>
            <button class="modal-close-btn" onclick="closeDrawingModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="drawing-tools">
            <div class="color-palette">
              <label class="color-option">
                <input type="radio" name="color" id="color-black" value="#000000" onchange="changeColor('#000000')" checked>
                <span class="color-swatch" style="background: #000000;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#ff0000" onchange="changeColor('#ff0000')">
                <span class="color-swatch" style="background: #ff0000;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#00ff00" onchange="changeColor('#00ff00')">
                <span class="color-swatch" style="background: #00ff00;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#0000ff" onchange="changeColor('#0000ff')">
                <span class="color-swatch" style="background: #0000ff;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#ffff00" onchange="changeColor('#ffff00')">
                <span class="color-swatch" style="background: #ffff00;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#ff00ff" onchange="changeColor('#ff00ff')">
                <span class="color-swatch" style="background: #ff00ff;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#00ffff" onchange="changeColor('#00ffff')">
                <span class="color-swatch" style="background: #00ffff;"></span>
              </label>
              <label class="color-option">
                <input type="radio" name="color" value="#ffa500" onchange="changeColor('#ffa500')">
                <span class="color-swatch" style="background: #ffa500;"></span>
              </label>
            </div>
            
            <div class="tool-actions">
              <button class="tool-btn" id="color-eraser" onclick="selectEraser()">
                <i class="fas fa-eraser"></i>
                Eraser
              </button>
              <button class="tool-btn" onclick="clearCanvas()">
                <i class="fas fa-trash"></i>
                Clear All
              </button>
            </div>
          </div>
          
          <div class="canvas-container">
            <canvas id="drawing-canvas"></canvas>
          </div>
          
          <div class="drawing-actions">
            <button class="button is-light" onclick="closeDrawingModal()">
              <i class="fas fa-times"></i>
              Cancel
            </button>
            <button class="button is-success" onclick="sendDrawing()">
              <i class="fas fa-paper-plane"></i>
              Send Drawing
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
    // Block WebSocket creation
    const OriginalWebSocket = window.WebSocket;
    window.WebSocket = function(...args) {
        console.error('Someone is creating WebSocket!', args);
        console.trace('WebSocket created from:');
        throw new Error('WebSocket is blocked for debugging!');
    };

    console.log('WebSocket blocked');
    </script>
    <script src="../connection.js"></script>
    <script src="../ui.js"></script>
    <script src="../message.js"></script>
    <script src="../file.js"></script>
    <script src="../drawing.js"></script>
    <script src="../utils.js"></script>
  </body>
</html>